# Boas-vindas ao reposit√≥rio de exerc√≠cios de ORM - Associations N:N e Transactions

Nesse exerc√≠cio, utilizaremos as `associations e transactions` do Sequelize para criar uma API, que gerencia um sistema de sa√∫de. Vamos l√°?

Para desenvolver o exerc√≠cio, voc√™ dever√° seguir contidas nesse README. Tenha aten√ß√£o ao que √© pedido e em caso de d√∫vida, procure o time de instru√ß√£o via _Slack_ ou nas mentorias! #vqv üöÄ

## Termos e acordos

Ao iniciar este exerc√≠cio, voc√™ concorda com as diretrizes do C√≥digo de Conduta e do Manual da Pessoa Estudante da Trybe.

## Entreg√°veis

<details>
  <summary><strong>ü§∑üèΩ‚Äç‚ôÄÔ∏è Como entregar</strong></summary><br />

Para entregar o seu exerc√≠cio voc√™ dever√° criar um Pull Request neste reposit√≥rio.

Lembre-se que voc√™ pode consultar nosso conte√∫do sobre [Git & GitHub](https://app.betrybe.com/learn/course/5e938f69-6e32-43b3-9685-c936530fd326/module/fc998c60-386e-46bc-83ca-4269beb17e17/section/fe827a71-3222-4b4d-a66f-ed98e09961af/day/35e03d5e-6341-4a8c-84d1-b4308b2887ef/lesson/573db55d-f451-455d-bdb5-66545668f436) e nosso [Blog - Git & GitHub](https://blog.betrybe.com/tecnologia/git-e-github/) sempre que precisar!
</details>

<details>
  <summary><strong>üë®‚Äçüíª O que dever√° ser desenvolvido</strong></summary><br />

  Hoje, nosso exerc√≠cio ser√° gerir o banco de dados e seus relacionamentos, utilizando o ORM Sequelize. Para isso, voc√™ criar√° as `models` para cumprir com tal tarefa.
  
 Por meio de exerc√≠cios n√£o avaliativos e b√¥nus n√£o avaliativos, voc√™ deve construir uma API que ser√° respons√°vel pela gest√£o de um sistema de sa√∫de.

</details>

<details>
  <summary><strong>üöµ Habilidades a serem trabalhadas</strong></summary><br />


  * Criar modelos;
  * Relacionar dois modelos com _hasMany_;
  * Relacionar dois modelos com _belongsTo_;
  * Relacionar dois modelos com _belongsToMany_;
  * **N√£o avaliativo** Utilizar _eager loading_ ou _lazy loading_;

</details>

# Orienta√ß√µes

<details>
  <summary><strong>üêã Rodando no Docker vs Localmente</strong></summary>
  
  ## üëâ Com Docker

  **:warning: Antes de come√ßar, seu docker-compose precisa estar na vers√£o 1.29 ou superior. [Veja aqui](https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-compose-on-ubuntu-20-04-pt) ou [na documenta√ß√£o](https://docs.docker.com/compose/install/) como instal√°-lo. No primeiro artigo, voc√™ pode substituir onde est√° com `1.26.0` por `1.29.2`.**

  > :information_source: Rode os servi√ßos `node` e `db` com o comando `docker-compose up -d --build`.

  * Lembre-se de parar o `mysql` se estiver usando localmente na porta padr√£o (`3306`), ou adapte, caso queria fazer uso da aplica√ß√£o em containers;

  * Esses servi√ßos ir√£o inicializar um container chamado `api` e outro chamado `mysql`;

  * A partir daqui voc√™ pode rodar o container `api` via CLI ou abri-lo no VS Code;

  > :information_source: Use o comando `docker exec -it api sh`.

  * Ele te dar√° acesso ao terminal interativo do container criado pelo compose, que est√° rodando em segundo plano.

  > :information_source: Instale as depend√™ncias [**Caso existam**] com `npm install`. (Instale dentro do container)
  
  * **:warning: Aten√ß√£o:** Caso opte por utilizar o Docker, **TODOS** os comandos dispon√≠veis no `package.json` (npm start, npm test, npm run dev, ...) devem ser executados **DENTRO** do container, ou seja, no terminal que aparece ap√≥s a execu√ß√£o do comando `docker exec` citado acima.

  * **:warning: Aten√ß√£o:** O **git** dentro do container n√£o vem configurado com suas credenciais. Ou fa√ßa os commits fora do container, ou configure as suas credenciais do git dentro do container.

  * **:warning: Aten√ß√£o:** N√£o rode o comando npm audit fix! Ele atualiza v√°rias depend√™ncias do projeto, e essa atualiza√ß√£o gera conflitos com o avaliador.

  * ‚ú® **Dica:** A extens√£o `Remote - Containers` (que estar√° na se√ß√£o de extens√µes recomendadas do VS Code) √© indicada para que voc√™ possa desenvolver sua aplica√ß√£o no container Docker direto no VS Code, como voc√™ faz com seus arquivos locais.

  <br />
  
  ## üëâ Sem Docker

  > :information_source: Instale as depend√™ncias [**Caso existam**] com `npm install`
  
  * **:warning: Aten√ß√£o:** N√£o rode o comando `npm audit fix`! Ele atualiza v√°rias depend√™ncias do exerc√≠cio, e essa atualiza√ß√£o gera conflitos com o avaliador.

  * **‚ú® Dica:** Para rodar o exerc√≠cio desta forma, obrigatoriamente voc√™ deve ter o `node` instalado em seu computador.
  * **‚ú® Dica:** O avaliador espera que a vers√£o do `node` utilizada seja a 16.

  <br/>

</details>

<details>
  <summary id="antes-comecar-desenvolver"><strong>‚ÄºÔ∏è Antes de come√ßar a desenvolver</strong></summary><br />

1. Clone o reposit√≥rio

* `git clone git@github.com:tryber/sd-040-exercise-sequelize-associations.git`.
* Entre na pasta do reposit√≥rio que voc√™ acabou de clonar:
  * `cd sd-040-exercise-sequelize-associations`

2. Instale as depend√™ncias

* `npm install`

3. Crie uma branch a partir da branch `main`

* Verifique que voc√™ est√° na branch `main`
  * Exemplo: `git branch`
* Se n√£o estiver, mude para a branch `main`
  * Exemplo: `git checkout main`
* Agora, crie uma branch onde voc√™ vai guardar os `commits` do seu exerc√≠cio
  * Voc√™ deve criar uma branch no seguinte formato: `nome-de-usuario-nome-do-exerc√≠cio`
  * Exemplo: `git checkout -b seunome-exercise-sequelize-associations`

4. Adicione as mudan√ßas ao _stage_ do Git e fa√ßa um `commit`

* Verifique que as mudan√ßas ainda n√£o est√£o no _stage_
  * Exemplo: `git status` (deve aparecer o arquivo que voc√™ alterou como exercicio1.sql)
* Adicione o novo arquivo ao _stage_ do Git
  * Exemplo:
    * `git add .` (adicionando todas as mudan√ßas - _que estavam em vermelho_ - ao stage do Git)
    * `git status` (deve aparecer listado o arquivo _seunome/README.md_ em verde)
* Fa√ßa o `commit` inicial
  * Exemplo:
    * `git commit -m 'iniciando o exerc√≠cio de Sequelize Associations'` (fazendo o primeiro commit)
    * `git status` (deve aparecer uma mensagem tipo _nothing to commit_ )

5. Adicione a sua branch com o novo `commit` ao reposit√≥rio remoto

* Usando o exemplo anterior: `git push -u origin seunome-exercise-sequelize-associations`

6. Crie um novo `Pull Request` _(PR)_

* V√° at√© a p√°gina de _Pull Requests_ do [reposit√≥rio no GitHub](https://github.com/tryber/sd-040-exercise-sequelize-associations/pulls)
* Clique no bot√£o verde _"New pull request"_
* Clique na caixa de sele√ß√£o _"Compare"_ e escolha a sua branch **com aten√ß√£o**
* Coloque um t√≠tulo para a sua _Pull Request_
  * Exemplo: _"Adiciona migrations"_
* Clique no bot√£o verde _"Create pull request"_
* Adicione uma descri√ß√£o para o _Pull Request_ e clique no bot√£o verde _"Create pull request"_
* **N√£o se preocupe em preencher mais nada por enquanto!**
* Volte at√© a [p√°gina de _Pull Requests_ do reposit√≥rio](https://github.com/tryber/sd-040-exercise-sequelize-associations/pulls) e confira que o seu _Pull Request_ est√° criado

</details>

<details>
  <summary><strong>‚å®Ô∏è Durante o desenvolvimento</strong></summary><br />

* Fa√ßa `commits` das altera√ß√µes que voc√™ fizer no c√≥digo regularmente

* Lembre-se de sempre ap√≥s um (ou alguns) `commits` atualizar o reposit√≥rio remoto

* Os comandos que voc√™ utilizar√° com mais frequ√™ncia s√£o:
  1. `git status` _(para verificar o que est√° em vermelho - fora do stage - e o que est√° em verde - no stage)_
  2. `git add` _(para adicionar arquivos ao stage do Git)_
  3. `git commit` _(para criar um commit com os arquivos que est√£o no stage do Git)_
  4. `git push -u origin nome-da-branch` _(para enviar o commit para o reposit√≥rio remoto na primeira vez que fizer o `push` de uma nova branch)_
  5. `git push` _(para enviar o commit para o reposit√≥rio remoto ap√≥s o passo anterior)_

</details>

<details>
  <summary><strong>üõ† Execu√ß√£o de testes localmente</strong></summary>

  * Rode o comando `npm test` dentro do container. O teste vai iniciar e depois encerrar, em segundo plano **outra inst√¢ncia da sua API, na porta `3030`**. Dessa forma, o teste conseguir√° consumir sua API e validar os requisitos.

  > :information_source: Scripts para executar os testes locais:

  Para executar os testes fora do container renomeie o arquivo `env.example` para `.env`. Vamos usar o Jest para executar os testes, use o comando a seguir para executar todos os testes:

  ```sh
  env $(cat .env) npm test
  ```

<br />
</details>

<details>
  <summary><strong> Implementa√ß√£o</strong></summary><br />

Nesse exerc√≠cio vamos criar as `models` do Sequelize para fazer as altera√ß√µes e requisi√ß√µes no banco de dados, para que possa ser utilizado na cria√ß√£o de uma API que ser√° respons√°vel pela gest√£o de um sistema de sa√∫de. 

Nesse sistema ter√£o pacientes, cada um com seu plano.
Cada paciente pode ter realizado v√°rias cirurgias, que por sua vez, devem ser listadas e categorizadas.
O diagrama abaixo demonstra como o banco de dados se comportar√°:

![Diagrama](images/diagrama3.png)

Este reposit√≥rio j√° cont√©m as depend√™ncias abaixo no `package.json`.

* Express;
* Nodemon;
* Sequelize;
* Mysql2;
* Sequelize-cli.

Al√©m disso, o exerc√≠cio j√° vem com a estrutura b√°sica do Sequelize configurada, portanto, **n√£o ser√° necess√°rio inicializar ou criar migrations ou seeders para as tabelas**, pois elas j√° est√£o feitas.

  <br/>
</details>

<details>
  <summary><strong>ü§ù Depois de terminar o desenvolvimento (opcional)</strong></summary><br />

  Para sinalizar que o seu exerc√≠cio est√° pronto para o _"Code Review"_, fa√ßa o seguinte:

* V√° at√© a p√°gina **DO SEU** _Pull Request_, adicione a label de _"code-review"_ e marque seus colegas
  * No menu √† direita, clique no _link_ **"Labels"** e escolha a _label_ **code-review**
  * No menu √† direita, clique no _link_ **"Assignees"** e escolha **o seu usu√°rio**
  * No menu √† direita, clique no _link_ **"Reviewers"** e digite `students`, selecione o time `tryber/students-sd-00`

  Caso tenha alguma d√∫vida, [aqui tem um video explicativo](https://vimeo.com/362189205).

</details>

<details>
  <summary><strong>üïµüèø Revisando um pull request</strong></summary><br />

  Use o conte√∫do sobre [Code Review](https://app.betrybe.com/learn/course/5e938f69-6e32-43b3-9685-c936530fd326/module/f04cdb21-382e-4588-8950-3b1a29afd2dd/section/b3af2f05-08e5-4b4a-9667-6f5f729c351d/lesson/36268865-fc46-40c7-92bf-cbded9af9006) para te ajudar a revisar os _Pull Requests_.

</details>

<details>
   <summary><strong>üóÇ Compartilhe seu portf√≥lio!</strong></summary>

Agora que voc√™ finalizou o exerc√≠cio, chegou a hora de mostrar ao mundo que voc√™ aprendeu algo novo! üöÄ

Siga esse [**guia que preparamos com carinho**](https://app.betrybe.com/learn/course/5e938f69-6e32-43b3-9685-c936530fd326/module/a3cac6d2-5060-445d-81f4-ea33451d8ea4/section/d4f5e97a-ca66-4e28-945d-9dd5c4282085/day/eff12025-1627-42c6-953d-238e9222c8ff/lesson/49cb103b-9e08-4ad5-af17-d423a624285a) para disponibilizar o exerc√≠cio finalizado no seu GitHub pessoal.

Esse passo √© super importante para ganhar mais visibilidade no mercado de trabalho, mas tamb√©m √© √∫til para manter um back-up do seu trabalho.

E voc√™ sabia que o LinkedIn √© a principal rede social profissional e compartilhar o seu aprendizado l√° √© muito importante para quem deseja construir uma carreira de sucesso? Compartilhe esse exerc√≠cio no seu LinkedIn, marque o perfil da Trybe (@trybe) e mostre para a sua rede toda a sua evolu√ß√£o.

   <br />
 </details>

</details>

# Exerc√≠cios

## Exerc√≠cios avaliativos

### üöÄ Exerc√≠cio 1

Crie o model de `Plan`.
Este deve ser criado no arquivo `src/models/Plan.js`.'
O nome do model deve ser definido como `Plan` e utilizar a tabela `plans`.
O model deve ter os seguintes campos:

* planId (referente ao plan_id na tabela plans)
* coverage
* price

### üöÄ Exerc√≠cio 2

Crie o model de `Patient`.
Este deve ser criado no arquivo `src/models/Patient.js`.
O nome do model deve ser definido como `Patient` e utilizar a tabela `patients`.
O model deve ter os seguintes campos:

* patientId (referente ao patient_id na tabela patients)
* fullname
* planId

### üöÄ Exerc√≠cio 3

Crie o model de `Surgery`.
Este deve ser criado no arquivo `src/models/Surgery.js`.
O nome do model deve ser definido como `Surgery` e utilizar a tabela `surgeries`.
O model deve ter os seguintes campos:

* surgeryId (referente ao campo surgery_id na tabela surgeries)
* specialty
* doctor

### üöÄ Exerc√≠cio 4

Crie o model de `PatientSurgery`.
Este deve ser criado no arquivo `src/models/PatientSurgery.js`.
O nome do model deve ser definido como `PatientSurgery` e utilizar a tabela `patient_surgeries`.
O model deve ter os seguintes campos:

* patientId (referente ao campo patient_id na tabela patient_surgeries)
* surgeryId (referente ao campo surgery_id na tabela patient_surgeries)

## Exerc√≠cios n√£o avaliativos

### üöÄ Exerc√≠cio 5

Crie um endpoint que liste todos os pacientes e seus respectivos planos.

### üöÄ Exerc√≠cio 6

Crie um endpoint que liste todos os pacientes e suas respectivas cirurgias realizadas.

### üöÄ Exerc√≠cio 7

Crie um endpoint que de acordo com o id de um plano, que deve ser recebido via requisi√ß√£o, liste os pacientes que o possuem.

# B√¥nus n√£o avaliativo

## üöÄ Exerc√≠cio 1

Crie um endpoint capaz de adicionar um novo paciente.

## üöÄ Exerc√≠cio 2

Crie um endpoint que liste todos os pacientes e suas cirurgias realizadas, mas oculte o nome do m√©dico respons√°vel.

## üöÄ Exerc√≠cio 3

Crie um endpoint que de acordo com o nome do m√©dico, que deve ser recebido via requisi√ß√£o, liste todas as cirurgias realizadas pelo mesmo, um get na url `http://localhost:3000/surgeries/Rey%20Dos%20Santos`deve retornar as cirurgias realizadas pelo m√©dico `Rey Dos Santos`.
